<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è€å©†ç”Ÿæ—¥ä¹‹æ—… x é›¨éœ13Y+æ˜•èŠ®11Y</title>
    <style>
        /* --- æ ¸å¿ƒæ¨£å¼ --- */
        :root {
            --primary: #4f46e5;
            --secondary: #ec4899;
            --tertiary: #8b5cf6;
            --bg-grad-start: #a18cd1;
            --bg-grad-end: #fbc2eb;
            --glass-bg: rgba(255, 255, 255, 0.96);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, var(--bg-grad-start), var(--bg-grad-end));
            margin: 0; padding: 0; color: #333;
            min-height: 100vh; padding-bottom: 90px;
        }

        /* ç½®é ‚å®¹å™¨ */
        .sticky-top-wrapper {
            position: sticky; top: 0; z-index: 1000;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .header-content { padding: 12px 16px 5px 16px; }
        
        .header-top { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; }
        .header-title h1 { margin: 0; font-size: 18px; color: #1f2937; font-weight: 800; line-height: 1.3; }
        .header-title p { margin: 2px 0 0; font-size: 12px; color: #db2777; font-weight: bold; }
        
        /* é ‚éƒ¨æŒ‰éˆ•å€ */
        .top-actions { display: flex; gap: 8px; justify-content: flex-end; width: 60%; }
        .header-btn {
            border-radius: 20px; padding: 6px 12px; font-size: 13px; font-weight: bold;
            cursor: pointer; display: flex; align-items: center; gap: 4px; text-decoration: none;
            border: 1px solid transparent; background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .toilet-btn { color: #2563eb; border-color: #bfdbfe; background: #eff6ff; }
        .family-btn { color: #db2777; border-color: #fbcfe8; background: #fdf2f8; }
        .metro-btn { color: #059669; border-color: #a7f3d0; background: #ecfdf5; }

        /* å¤©æ°£ */
        .weather-widget {
            background: linear-gradient(135deg, #60a5fa, #3b82f6);
            border-radius: 12px; padding: 10px 15px;
            color: white; box-shadow: 0 4px 6px rgba(59, 130, 246, 0.3);
            margin-bottom: 10px;
        }
        .weather-main { display: flex; align-items: center; justify-content: space-between; }
        .weather-left { display: flex; align-items: center; gap: 10px; }
        .w-icon { font-size: 32px; }
        .w-temp { font-size: 26px; font-weight: 800; }

        /* Tabs */
        .tabs-container {
            display: flex; gap: 8px; overflow-x: auto; 
            padding: 0 16px 12px 16px; -webkit-overflow-scrolling: touch;
        }
        .tabs-container::-webkit-scrollbar { display: none; }
        .tab-btn {
            padding: 8px 16px; border-radius: 20px; border: 1px solid #e5e7eb;
            background: #f9fafb; color: #4b5563; font-size: 13px; font-weight: bold; white-space: nowrap;
            transition: all 0.2s; flex-shrink: 0;
        }
        .tab-btn.active { background: var(--primary); color: white; border-color: var(--primary); box-shadow: 0 4px 8px rgba(79, 70, 229, 0.3); }
        .tab-btn.budget-tab.active { background: var(--secondary); border-color: var(--secondary); }
        .tab-btn.lang-tab.active { background: var(--tertiary); border-color: var(--tertiary); }
        .tab-btn.sos-tab.active { background: #ef4444; border-color: #ef4444; color: white; }

        /* å…§å®¹å®¹å™¨ */
        .container { padding: 20px 15px; max-width: 600px; margin: 0 auto; }

        /* è¡Œç¨‹å¡ç‰‡ */
        .card {
            background: var(--glass-bg); border-radius: 16px; padding: 16px;
            margin-bottom: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            border: 1px solid rgba(255,255,255,0.8);
        }
        .card.backup { background: #fffbeb; border: 2px dashed #fbbf24; }
        
        .card-header { display: flex; align-items: center; margin-bottom: 8px; }
        .time-tag { background: #f3f4f6; color: #6b7280; font-size: 13px; font-weight: bold; padding: 4px 8px; border-radius: 6px; margin-right: 10px; min-width: 55px; text-align: center; }
        .card-title { font-size: 18px; font-weight: bold; color: #111827; line-height: 1.3; flex: 1; }
        .card-icon { font-size: 22px; margin-right: 8px; }
        
        .info-block { margin-top: 8px; padding: 8px 10px; border-radius: 8px; font-size: 14px; line-height: 1.5; }
        .trans-style { background: #eff6ff; color: #1e40af; border-left: 3px solid #3b82f6; }
        .menu-style { background: #fff7ed; color: #9a3412; border-left: 3px solid #f97316; }
        .hours-style { display: inline-block; font-size: 13px; color: #059669; margin-top: 6px; font-weight: 600; background: rgba(209, 250, 229, 0.6); padding: 4px 8px; border-radius: 6px; }
        
        /* æ™‚é–“è­¦å‘Š */
        .time-warning { display: inline-block; font-size: 12px; font-weight: bold; margin-left: 5px; padding: 4px 8px; border-radius: 6px; animation: pulse 2s infinite; }
        .warn-closed { background: #fee2e2; color: #b91c1c; border: 1px solid #fca5a5; }
        .warn-soon { background: #ffedd5; color: #c2410c; border: 1px solid #fdba74; }
        @keyframes pulse { 0% {opacity:1;} 50% {opacity:0.7;} 100% {opacity:1;} }

        .note-style { font-size: 13px; color: #6b7280; margin-top: 8px; padding-left: 10px; border-left: 3px solid #d1d5db; }
        .connector { text-align: center; padding: 10px 0; color: #666; font-size: 12px; font-weight: bold; opacity: 0.8; }
        .connector span { background: rgba(255,255,255,0.6); padding: 4px 12px; border-radius: 12px; }

        /* æ™¯é»è©³æƒ… */
        .detail-area { display: none; margin-top: 12px; background: #f8fafc; border-radius: 8px; padding: 12px; border: 1px solid #e2e8f0; font-size: 14px; }
        .detail-row { display: flex; margin-bottom: 6px; }
        .detail-label { font-weight: bold; color: #64748b; width: 40px; flex-shrink: 0; }
        .detail-content { color: #334155; line-height: 1.4; }

        /* æŒ‰éˆ•ç¾¤çµ„ */
        .btn-row { 
            display: flex; gap: 8px; margin-top: 15px; 
            flex-wrap: wrap; /* å…è¨±æ›è¡Œ */
        }
        .action-btn { 
            flex: 1 0 40%; /* ç¢ºä¿æŒ‰éˆ•å¯¬åº¦ */
            border: none; padding: 12px 5px; border-radius: 12px; 
            font-size: 15px; font-weight: bold; cursor: pointer; text-align: center; 
            text-decoration: none; display: flex; align-items: center; justify-content: center; 
            gap: 6px; box-shadow: 0 3px 6px rgba(0,0,0,0.08); 
            min-width: 0; color: inherit;
        }
        .btn-icon-lg { font-size: 1.4em; line-height: 1; display: inline-block; }

        /* é¡è‰²è¨­å®š */
        .map-btn { background: #03C75A !important; color: white !important; }
        .driver-btn { background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); color: white !important; }
        .video-btn { background: #fee2e2; color: #b91c1c; border: 1px solid #fca5a5; }
        .info-btn { background: #e0f2fe; color: #0284c7; border: 1px solid #bae6fd; }
        .note-btn { background: #f3f4f6; color: #4b5563; border: 1px solid #d1d5db; flex: 0 0 44px; font-size: 18px; padding: 0; margin-left: auto; }
        .note-btn.has-note { background: #fef3c7; color: #d97706; border-color: #fcd34d; }

        /* ç­†è¨˜ */
        .note-area { display: none; margin-top: 12px; background: #fff; border: 1px solid #ddd; border-radius: 10px; padding: 10px; }
        .note-textarea { width: 100%; height: 80px; border: none; outline: none; font-size: 14px; resize: none; background: transparent; margin-bottom: 8px; }
        .save-btn { background: #4f46e5; color: white; border: none; padding: 6px 12px; border-radius: 6px; float: right; font-weight: bold; }
        .saved-note { margin-top: 10px; padding: 10px; background: #fffbeb; border-left: 3px solid #f59e0b; border-radius: 6px; display: none; }

        /* ç¿»è­¯ */
        .phrase-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .phrase-card { background: white; border-radius: 12px; padding: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border: 1px solid #eee; }
        .ph-zh { font-size: 15px; font-weight: bold; color: #5b21b6; margin-bottom: 4px; }
        .ph-kr { font-size: 16px; color: #1f2937; font-weight: 500; }
        .ph-pro { font-size: 12px; color: #666; margin-bottom: 8px; }
        .ph-actions { display: flex; gap: 8px; margin-top: 8px; }
        .ph-btn { flex: 1; padding: 8px; border-radius: 6px; border: none; font-size: 12px; font-weight: bold; cursor: pointer; background: #f3f4f6; }
        .btn-speak { background: #e0e7ff; color: #4338ca; }
        .section-title { font-size: 15px; font-weight: bold; color: #4b5563; margin: 20px 0 10px 5px; }

        /* é ç®— */
        .budget-form { background: white; border-radius: 16px; padding: 15px; margin-bottom: 20px; }
        .form-row { display: flex; gap: 10px; margin-bottom: 10px; width: 100%; }
        .form-input { padding: 12px; border: 1px solid #ddd; border-radius: 8px; width: 100%; font-size: 14px; box-sizing: border-box; min-width: 0; }
        .input-desc { flex: 7; } .input-amt { flex: 3; text-align: right; }
        .form-select { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 8px; width: 100%; background: white; }
        .add-expense-btn { width: 100%; padding: 12px; background: #111827; color: white; border: none; border-radius: 10px; font-weight: bold; }
        .expense-item { background: white; border-radius: 12px; padding: 15px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .ex-cat-icon { font-size: 24px; margin-right: 10px; width: 30px; text-align: center; }

        /* SOS */
        .sos-btn { display: block; width: 100%; padding: 15px; margin-bottom: 10px; border-radius: 12px; text-align: center; color: white; text-decoration: none; font-weight: bold; font-size: 16px; }
        .sos-112 { background: #1f2937; } .sos-119 { background: #dc2626; } .sos-tw { background: #059669; }

        /* Modal */
        #modal, #loc-modal, #vid-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 9999; justify-content: center; align-items: center; flex-direction: column; }
        .modal-kr { color: #fbbf24; font-size: 40px; font-weight: 800; text-align: center; margin: 20px; line-height: 1.3; }
        .modal-cn { color: #fff; font-size: 20px; margin-bottom: 30px; font-weight: bold; }
        .close-hint { padding: 8px 20px; border: 1px solid rgba(255,255,255,0.5); border-radius: 20px; color: rgba(255,255,255,0.8); cursor: pointer; }
        
        .loc-btn-group { display: flex; flex-direction: column; gap: 15px; width: 100%; max-width: 300px; }
        .loc-big-btn { background: #333; color: white; padding: 15px; border-radius: 12px; font-size: 16px; font-weight: bold; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; text-decoration: none; }
        .loc-big-btn.google { background: #4285F4; }
        .loc-big-btn.apple { background: #000000; border: 1px solid #333; }
        .loc-big-btn.sos { background: #ef4444; }

        .video-container { width: 100%; max-width: 600px; aspect-ratio: 16/9; background: black; }
        iframe { width: 100%; height: 100%; border: none; }
        .yt-external-btn { display: inline-block; margin-top: 15px; padding: 10px 20px; background: #ff0000; color: white; border-radius: 30px; text-decoration: none; font-weight: bold; font-size: 14px; }
        
        #toast { visibility: hidden; min-width: 200px; background-color: #333; color: #fff; text-align: center; border-radius: 30px; padding: 12px; position: fixed; z-index: 10000; left: 50%; bottom: 30px; transform: translateX(-50%); font-size: 14px; }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }
    </style>
</head>
<body>

    <div class="sticky-top-wrapper">
        <div class="header-content">
            <div class="header-top">
                <div class="header-title">
                    <h1>è€å©†ç”Ÿæ—¥ä¹‹æ—… x é›¨éœ13Y+æ˜•èŠ®11Y</h1>
                    <p>2026/02/12 Happy Birthday! ğŸ‡°ğŸ‡·</p>
                </div>
                <div class="top-actions">
                    <a href="https://m.map.naver.com/search2/search.naver?query=%ED%99%94%EC%9E%A5%EC%8B%A4" target="_blank" class="header-btn toilet-btn">ğŸš½ å»æ‰€</a>
                    <button class="header-btn family-btn" onclick="openLocModal()">ğŸ“ å®¶äºº</button>
                    <a href="https://map.konest.com/psubway" target="_blank" class="header-btn metro-btn">ğŸš‡ åœ°éµ</a>
                </div>
            </div>
            
            <div id="weather-box" class="weather-widget">
                <div class="weather-main">
                    <div class="weather-left">
                        <span id="w-icon" class="w-icon">âŒ›</span>
                        <div>
                            <div style="font-size:12px;">é¦–çˆ¾å³æ™‚æ°£æº«</div>
                            <div id="w-temp" class="w-temp">--Â°C</div>
                        </div>
                    </div>
                    <div id="w-range" class="weather-right">--Â° / --Â°</div>
                </div>
            </div>
        </div>

        <div id="tabs" class="tabs-container"></div>
    </div>

    <div class="container">
        <div id="list"></div>
        <div id="budget-view" style="display:none;"></div>
        <div id="lang-view" style="display:none;"></div>
        <div id="sos-view" style="display:none;"></div>
    </div>

    <div id="modal" onclick="this.style.display='none'">
        <div style="color:#fff; font-size:18px;">è«‹è¼‰æˆ‘å» / To here please:</div>
        <div id="m-kr" class="modal-kr"></div>
        <div style="color:#aaa; border:1px solid #aaa; padding:5px 15px; border-radius:20px;">é»æ“Šé—œé–‰</div>
    </div>

    <div id="loc-modal" onclick="if(event.target===this) closeLocModal()">
        <div style="background: white; padding: 25px; border-radius: 20px; width: 90%; max-width: 350px; text-align: center; color: #333;">
            <h2 style="margin-top:0; font-size:20px;">ğŸ“ å®¶äººä½ç½®åˆ†äº«</h2>
            <p style="font-size:13px; color:#666; margin-bottom:20px;">ä½¿ç”¨å‰è«‹ç¢ºèªå®¶äººå·²é–‹å•Ÿåˆ†äº«</p>
            <div class="loc-btn-group">
                <a href="https://www.google.com/maps" target="_blank" class="loc-big-btn google">ğŸ—ºï¸ Google åœ°åœ–åˆ†äº«</a>
                <a href="findmy://" class="loc-big-btn apple">ğŸ Apple å°‹æ‰¾ (Find My)</a>
                <button onclick="sendMyLoc()" class="loc-big-btn sos">ğŸ“¡ å‚³é€æˆ‘çš„ä½ç½®</button>
            </div>
            <div onclick="closeLocModal()" style="margin-top:20px; padding:10px; color:#999; font-size:14px; cursor:pointer;">é—œé–‰è¦–çª—</div>
        </div>
    </div>

    <div id="vid-modal" onclick="if(event.target===this) closeVidModal()">
        <div style="width: 100%; max-width: 600px;">
            <div id="vid-container" class="video-container">
                <iframe id="vid-frame" src="" allowfullscreen></iframe>
            </div>
            <a id="vid-link" href="#" target="_blank" class="yt-external-btn">ğŸ“º ç„¡æ³•æ’­æ”¾ï¼Ÿé»æ­¤å» App çœ‹</a>
        </div>
    </div>
    
    <div id="toast">å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼</div>

    <script>
        // --- 1. è³‡æ–™åº« (å®Œæ•´è¡Œç¨‹) ---
        var tripData = [
            { day: "Day 1 (ä¸‰)", date: "02/11", events: [
                { time: "19:15", icon: "ğŸ›¬", title: "æŠµé”é‡‘æµ¦æ©Ÿå ´", trans: "ğŸš¶ è·Ÿéš¨ AREX æŒ‡æ¨™" },
                { connect: "â¬‡ï¸ æ©Ÿå ´åœ°éµ (å¾€é¦–çˆ¾ç«™)" },
                { time: "20:00", icon: "ğŸš‡", title: "ç§»å‹•ï¼šå­”å¾·ç«™", trans: "ğŸš‡ å­”å¾·ç«™ä¸‹è»Š â” 2è™Ÿå‡ºå£ (æœ‰é›»æ¢¯)" },
                { connect: "â¬‡ï¸ æ­¥è¡Œ 600m" },
                { time: "20:45", icon: "ğŸ¨", title: "Roynet Hotel Check-in", note: "å…ˆæ”¾è¡Œæï¼Œç¨ä½œä¼‘æ¯", open: "15:00 - 23:59", map: "ë¡œì´ë„·í˜¸í…” ì„œìš¸ ë§ˆí¬" },
                { connect: "â¬‡ï¸ éé¦¬è·¯åˆ°å°é¢å··å­ (3åˆ†é˜)" },
                { time: "21:20", icon: "ğŸ¥©", title: "æ™šé¤ï¼šå…ƒç¥–è¶™æœ´å®¶", menu: "èª¿å‘³è±¬æ’éª¨ã€è˜¿è””å†·éºµã€ç”œç±³éœ²", open: "11:30 - 22:00", map: "ì›ì¡°ì¡°ë°•ì§‘", video: "hQTMdak-XfY",
                  desc: "éº»æµ¦å€æœ€çŸ¥åçš„çƒ¤è±¬æ’éª¨è€åº—ï¼Œè‚‰è³ªè»Ÿå«©ï¼Œé™„è´ˆçš„ç”œç±³éœ²æ˜¯çµ•é…ã€‚", price: "é ç®—: â‚©18,000/äºº", duration: "1.5 å°æ™‚" },
                { connect: "â¬‡ï¸ æ­¥è¡Œå›é£¯åº— (5åˆ†é˜)" },
                { time: "22:45", icon: "ğŸ¨", title: "å›é£¯åº—ä¼‘æ¯", note: "é¤Šç²¾è“„éŠ³ï¼Œæ˜å¤©æ—©èµ·ï¼" }
            ]},
            { day: "Day 2 (å››)", date: "02/12 (è€å©†ç”Ÿæ—¥ğŸ‚)", events: [
                { time: "09:00", icon: "ğŸš•", title: "å‰å¾€æ™¯ç¦å®®", trans: "ğŸš• å¾é£¯åº—ç›´æ¥æ­è¨ˆç¨‹è»Š", kr: "ê²½ë³µê¶ ë§¤í‘œì†Œ", map: "ê²½ë³µê¶" },
                { time: "09:30", icon: "ğŸ¯", title: "æ™¯ç¦å®® (ç´”åƒè§€)", note: "é€›å®Œå¾å´é–€ (å»ºæ˜¥é–€) é›¢é–‹", open: "09:00 - 17:00", map: "ê²½ë³µê¶", video: "mVQ0ueFjt_4",
                  desc: "æœé®®ç‹æœç¬¬ä¸€æ³•å®®ï¼Œå»ºæ–¼1395å¹´ã€‚å¿…çœ‹å‹¤æ”¿æ®¿èˆ‡æ…¶æœƒæ¨“ã€‚", price: "é–€ç¥¨: â‚©3,000", duration: "1.5 - 2 å°æ™‚" },
                { connect: "â¬‡ï¸ æ²¿çŸ³ç‰†è·¯æ•£æ­¥ç´„ 15 åˆ†é˜" },
                { time: "11:00", icon: "ğŸ˜ï¸", title: "åŒ—æ‘éŸ“å±‹æ‘", note: "ä¿æŒå®‰éœ", map: "ë¶ì´Œí•œì˜¥ë§ˆì„", video: "TArU4_cwE6M",
                  desc: "ä¿å­˜å®Œæ•´çš„å‚³çµ±éŸ“å±‹èšè½ï¼Œè¨˜å¾—ä¿æŒå®‰éœï¼Œä¸è¦æ‰“æ“¾å±…æ°‘ã€‚", price: "å…è²»åƒè§€", duration: "1 å°æ™‚" },
                { time: "12:00", icon: "ğŸš•", title: "TNF (è¬é‡Œæ´)", trans: "ğŸš• æ——è‰¦åº—", kr: "ë…¸ìŠ¤í˜ì´ìŠ¤ ë§Œë¦¬ë™ì§ì˜ì ", open: "10:30 - 20:00", map: "ë…¸ìŠ¤í˜ì´ìŠ¤ í™ë³´ê´€" },
                { time: "13:00", icon: "ğŸ¨", title: "å›é£¯åº—åˆä¼‘", note: "å……é›»æ™‚é–“" },
                { time: "16:30", icon: "ğŸ’°", title: "æ˜æ´æ›éŒ¢ & é€›è¡—", open: "è‡³ 20:00", map: "ëª…ë™ ëŒ€ì‚¬ê´€í™˜ì „", video: "scHPC0f2Sg4" },
                { time: "17:30", icon: "ğŸ¥©", title: "è’è¬¬çš„ç”Ÿè‚‰", menu: "äº”èŠ±è‚‰åƒåˆ°é£½", open: "11:00 - 23:00", map: "ì—‰í„°ë¦¬ìƒê³ ê¸° ëª…ë™", price: "é ç®—: â‚©16,800", duration: "1.5 å°æ™‚" },
                { time: "18:30", icon: "â­", title: "POCA SPOT", note: "å¥³å…’è¿½æ˜Ÿ", map: "í¬ì¹´ìŠ¤íŒŸ" },
                { time: "19:30", icon: "ğŸš ", title: "ç§»å‹•ï¼šå—å±±çºœè»Š", trans: "ğŸš• æ­è»Šå»çºœè»Šç«™", kr: "ë‚¨ì‚°ì¼€ì´ë¸”ì¹´", map: "ë‚¨ì‚°ì¼€ì´ë¸”ì¹´" },
                { time: "20:00", icon: "ğŸ—¼", title: "Né¦–çˆ¾å¡”", open: "10:00 - 23:00", map: "Nì„œìš¸íƒ€ì›Œ", video: "FHWcoQfVtwE",
                  desc: "é¦–çˆ¾åœ°æ¨™ï¼Œå¯ä¿¯ç°360åº¦å¤œæ™¯ã€‚", price: "è§€æ™¯å° â‚©21,000", duration: "1 - 1.5 å°æ™‚" },
                { time: "21:30", icon: "ğŸš•", title: "ç§»å‹•ï¼šå›é£¯åº—", kr: "ë¡œì´ë„·í˜¸í…” ì„œìš¸ ë§ˆí¬" },
                { connect: "ğŸ›‘ é›¨å¤©/æ›¿ä»£æ–¹æ¡ˆ (å»£è—å¸‚å ´è·¯ç·š)" },
                { time: "11:45", icon: "ğŸ¥¢", title: "å‚™æ¡ˆï¼šå»£è—å¸‚å ´", menu: "ç”Ÿç‰›è‚‰ã€ç¶ è±†ç…é¤…", backup: true, video: "HybSjjgFUaY", map: "ê´‘ì¥ì‹œì¥", desc: "å‚³çµ±å¸‚å ´ç¾é£Ÿå·¡ç¦®" },
                { time: "13:15", icon: "ğŸš•", title: "äº¤é€šï¼šå¸‚å ´ â” TNF", trans: "ğŸš• ç´„ 15 åˆ†é˜", kr: "ë…¸ìŠ¤í˜ì´ìŠ¤ ë§Œë¦¬ë™ì§ì˜ì ", backup: true }
            ]},
            { day: "Day 3 (äº”)", date: "02/13", events: [
                { time: "10:15", icon: "ğŸŒ²", title: "é¦–çˆ¾æ—å…¬åœ’", note: "Jennie æ•£æ­¥æ™¯é»", map: "ì„œìš¸ìˆ²", video: "7hNxv16FNyI",
                  desc: "é¦–çˆ¾çš„ä¸­å¤®å…¬åœ’ï¼Œç’°å¢ƒå„ªç¾ï¼Œé©åˆæ•£æ­¥æ‹ç…§ã€‚", price: "å…è²»", duration: "1 - 2 å°æ™‚" },
                { time: "12:10", icon: "ğŸš", title: "åˆé¤ï¼šå¥¶å¥¶çš„é£Ÿè­œ", menu: "çƒ¤é­šå¥—é¤ã€ç‰›éª¨æ¹¯ã€è¾£ç‚’è±¬è‚‰", open: "11:30 - 21:00", map: "í• ë¨¸ë‹ˆì˜ë ˆì‹œí”¼",
                  desc: "ç±³å…¶æ—æ¨è–¦çš„å®¶å¸¸éŸ“å¼å®šé£Ÿï¼Œå£å‘³æ¸…æ·¡ç²¾ç·»ã€‚", price: "å¥—é¤ç´„ â‚©15,000", duration: "1 å°æ™‚" },
                { time: "13:30", icon: "ğŸ•¶ï¸", title: "HAUS NOWHERE", note: "Gentle Monster", open: "11:00 - 21:00", map: "í•˜ìš°ìŠ¤ ë…¸ì›¨ì–´ ì„±ìˆ˜",
                  desc: "çµåˆæœªä¾†æ„Ÿèˆ‡è—è¡“çš„è¤‡åˆå¼ç©ºé–“ï¼Œéå¸¸å¥½æ‹ã€‚", price: "å…è²»å…¥å ´", duration: "40 åˆ†é˜" },
                { time: "14:20", icon: "ğŸ°", title: "Miffy & NYUNYU", note: "é£¾å“å¤©å ‚", map: "ë‰´ë‰´ ì„±ìˆ˜" },
                { time: "15:00", icon: "ğŸ§±", title: "å¤§æ—å€‰åº«", note: "å¿…æ‹ç´…ç£šç‰†", open: "11:00 - 22:00", map: "ì„±ìˆ˜ ëŒ€ë¦¼ì°½ê³ " },
                { time: "15:15", icon: "ğŸ•¯ï¸", title: "Hetras è–°é¦™åº—", note: "å¹³åƒ¹æœ‰è³ªæ„Ÿçš„æ“´é¦™", map: "í—¤íŠ¸ë¼ìŠ¤ ì„±ìˆ˜" },
                { time: "15:20", icon: "â˜•", title: "New Mix Coffee", note: "å¿…è²·ç²¾å“å³æº¶å’–å•¡", map: "ë‰´ë¯¹ìŠ¤ì»¤í”¼" },
                { time: "15:30", icon: "ğŸ¥", title: "è‡ªç„¶å³¶é¹½éºµåŒ…", menu: "é¹½éºµåŒ… (4å…¥ä¸€çµ„)", open: "09:00 - å”®å®Œ", map: "ìì—°ë„ì†Œê¸ˆë¹µ ì„±ìˆ˜" },
                { time: "16:10", icon: "ğŸ’™", title: "Human Made", note: "æ„›å¿ƒTæ¤", map: "íœ´ë¨¼ë©”ì´ë“œ ì„±ìˆ˜" },
                { time: "16:50", icon: "ğŸ’", title: "Tamburins & Dior", note: "Jennie é¦™æ°› & Jisoo æ¦‚å¿µåº—", open: "11:00 - 21:00", map: "ë””ì˜¬ ì„±ìˆ˜", video: "2PBL-ZqZ3iE",
                  desc: "Dior è–æ°´æ¦‚å¿µåº—ï¼Œå»ºç¯‰å¤–è§€çµ•ç¾ï¼Œæ™šä¸Šé»ç‡ˆæ›´æ¼‚äº®ã€‚", price: "å…è²» (éœ€é ç´„æˆ–æ’éšŠ)", duration: "30 åˆ†é˜" },
                { time: "18:00", icon: "ğŸ–", title: "æ™šé¤ï¼šå¤§æˆæ’éª¨", menu: "èª¿å‘³æ’éª¨ã€æ³¡èœé‹ & é†¬èŸ¹", open: "12:00 - 21:00", map: "ëŒ€ì„±ê°ˆë¹„",
                  desc: "è–æ°´æ´æ’éª¨è¡—è€åº—ï¼Œç‚­ç«é¦™æ°£åè¶³ã€‚", price: "é ç®—: â‚©17,000/äºº", duration: "1.5 å°æ™‚" },
                { connect: "â¬‡ï¸ æ­è¨ˆç¨‹è»Šå›é£¯åº—" },
                { time: "20:00", icon: "ğŸš•", title: "ç§»å‹•ï¼šå›é£¯åº—", trans: "ğŸš• åƒé£½æ­è»Šå›å®¶", kr: "ë¡œì´ë„·í˜¸í…” ì„œìš¸ ë§ˆí¬" }
            ]},
            { day: "Day 4 (å…­)", date: "02/14", events: [
                { time: "10:00", icon: "ğŸ’†â€â™€ï¸", title: "Orta Clinic (åšè‡‰)", note: "Seoho Building 3F", open: "10:00 - 16:00", map: "ì˜¤ë¥´íƒ€ì˜ì›" },
                { time: "13:00", icon: "ğŸ“š", title: "æ˜Ÿç©ºåœ–æ›¸é¤¨ (COEX)", note: "ç¶²ç¾å¿…æ‹åœ–æ›¸é¤¨", open: "10:30 - 22:00", map: "ë³„ë§ˆë‹¹ ë„ì„œê´€", video: "BFZqnRhNnpI",
                  desc: "ä½æ–¼ COEX å•†å ´å…§ï¼Œé«˜é”13ç±³çš„æ›¸ç‰†éå¸¸å£¯è§€ã€‚", price: "å…è²»", duration: "1 å°æ™‚" },
                { connect: "â¬‡ï¸ æ­åœ°éµ 2 è™Ÿç·š (ä¸‰æˆç«™ â” æ±Ÿå—ç«™)" },
                { time: "16:00", icon: "ğŸ›ï¸", title: "æ±Ÿå—åœ°ä¸‹è¡—", trans: "ğŸš‡ æ­ä¹˜åœ°éµ2è™Ÿç·šè‡³æ±Ÿå—ç«™ï¼Œç«™å…§ç›´é€š", open: "10:00 - 22:00", map: "ê°•ë‚¨ì—­ ì§€í•˜ì‡¼í•‘ì„¼í„°" },
                { time: "18:00", icon: "ğŸ”", title: "æ™šé¤ï¼šå¤¢æ‘éµæ¿é›", menu: "éŸ“æ–¹è¾£ç‚’é›ã€å†·çƒé¾éºµ", open: "11:30 - 21:30", map: "ëª½ì´Œë‹­ê°ˆë¹„" },
                { time: "20:00", icon: "ğŸš¶", title: "çŸ³æ‘æ¹–æ°´å…¬åœ’", note: "é£¯å¾Œæ•£æ­¥ï¼Œçœ‹æ¨‚å¤©ä¸–ç•Œå¡”å¤œæ™¯", map: "ì„ì´Œí˜¸ìˆ˜" },
                { connect: "â¬‡ï¸ æ­è¨ˆç¨‹è»Šè·¨æ±Ÿ" },
                { time: "21:00", icon: "ğŸš•", title: "ç§»å‹•ï¼šå›é£¯åº—", kr: "ë¡œì´ë„·í˜¸í…” ì„œìš¸ ë§ˆí¬" }
            ]},
            { day: "Day 5 (æ—¥)", date: "02/15", events: [
                { time: "09:30", icon: "ğŸš•", title: "ç§»å‹•ï¼šå»æ¢¨èŠ±å¥³å¤§", trans: "ğŸš• ç›´æ¥æ­è»Šå»æ­£é–€æ‹ç…§", kr: "ì´í™”ì—¬ìëŒ€í•™êµ ì •ë¬¸", map: "ì´í™”ì—¬ìëŒ€í•™êµ" },
                { time: "12:00", icon: "ğŸŸ", title: "åˆé¤ï¼šé¢¨å·é°»é­š", menu: "ç‚­çƒ¤é°»é­šã€æ³¡èœæ²éºµ", open: "11:00 - 22:30", map: "í’ì²œì¥ì–´ ì—°ë‚¨ì ",
                  desc: "ç¾æ®ºç¾çƒ¤çš„æ´»é°»é­šï¼Œå¤–çš®é…¥è„†è‚‰è³ªQå½ˆã€‚", price: "é ç®—: å…©æ¢ â‚©78,000", duration: "1.5 å°æ™‚" },
                { time: "13:35", icon: "â˜•", title: "Antique Coffee", menu: "é«’é«’å¥¶æ²¹æ‹¿éµã€é«’é«’æŠ¹èŒ¶å¯é Œ", open: "10:00 - 22:00", map: "ì•¤í‹°í¬ì»¤í”¼ ì—°ë‚¨ì " },
                { time: "15:00", icon: "ğŸ›ï¸", title: "å¤§å‰µ (å¼˜å¤§2è™Ÿåº—)", note: "7å±¤æ¨“æ——è‰¦åº—", map: "ë‹¤ì´ì†Œ í™ëŒ€2í˜¸ì " },
                { time: "16:30", icon: "ğŸ‘•", title: "Musinsa Standard", note: "å¼˜å¤§æ——è‰¦åº—", open: "11:00 - 21:00", map: "ë¬´ì‹ ì‚¬ ìŠ¤íƒ ë‹¤ë“œ í™ëŒ€" },
                { time: "17:30", icon: "â­", title: "idOLSTORE", note: "å¶åƒå‘¨é‚Š", map: "ì•„ì´ëŒìŠ¤í† ì–´" },
                { time: "18:00", icon: "ğŸ’Š", title: "å¼˜ç›Šè—¥å±€", note: "æœ€å¾Œè£œè²¨", map: "í™ìµì•½êµ­" },
                { time: "19:00", icon: "ğŸ›’", title: "æ¨‚å¤©è¶…å¸‚ (é¦–çˆ¾ç«™)", note: "æœ€å¾Œæ¡è²·ä¼´æ‰‹ç¦®", open: "10:00 - 23:00", map: "ë¡¯ë°ë§ˆíŠ¸ ì„œìš¸ì—­ì " },
                { connect: "â¬‡ï¸ æ­è¨ˆç¨‹è»Š (å¤§åŒ…å°åŒ…)" },
                { time: "20:30", icon: "ğŸš•", title: "ç§»å‹•ï¼šå›é£¯åº—", kr: "ë¡œì´ë„·í˜¸í…” ì„œìš¸ ë§ˆí¬" }
            ]},
            { day: "Day 6 (ä¸€)", date: "02/16", events: [
                { time: "09:10", icon: "ğŸ¥£", title: "æ—©é¤ï¼šå…ƒç¥–éº»æµ¦å±‹", menu: "éŸ“ç‰›é›ªæ¿ƒæ¹¯ (ç±³å…¶æ—æ¨è–¦)", open: "07:00 - 21:00", map: "ë§ˆí¬ì˜¥" },
                { time: "11:15", icon: "ğŸšŒ", title: "æ­æ©Ÿå ´å·´å£« 6015", trans: "ğŸšŒ ç¢ºèªå¾€ã€Œä»å·æ©Ÿå ´ã€ï¼Œä¸Šè»Šä»˜ç¾", note: "ç¥¨åƒ¹ï¼šæˆäºº â‚©17,000 / å…’ç«¥ â‚©12,000" }
            ]}
        ];

        // --- 2. ç¿»è­¯èˆ‡å…¶ä»–è³‡æ–™ ---
        var phrases = [
            { cat: "ğŸ—£ï¸ è¬ç”¨", list: [{ zh: "ä½ å¥½", kr: "ì•ˆë…•í•˜ì„¸ìš”", pro: "An-nyeong" }, { zh: "è¬è¬", kr: "ê°ì‚¬í•©ë‹ˆë‹¤", pro: "Gam-sa" }, { zh: "ä¸å¥½æ„æ€", kr: "ì €ê¸°ìš”", pro: "Jeo-gi-yo" }, { zh: "ä¸æœƒéŸ“æ–‡", kr: "í•œêµ­ë§ ëª»í•´ìš”", pro: "Han-guk-mal mo-tae-yo" }] },
            { cat: "ğŸ´ åƒé£¯", list: [{ zh: "è«‹çµ¦æˆ‘èœå–®", kr: "ë©”ë‰´íŒ ì£¼ì„¸ìš”", pro: "Menu-pan" }, { zh: "æˆ‘è¦é€™å€‹", kr: "ì´ê±° ì£¼ì„¸ìš”", pro: "I-geo" }, { zh: "è«‹çµ¦æˆ‘æ°´", kr: "ë¬¼ ì¢€ ì£¼ì„¸ìš”", pro: "Mul" }, { zh: "æœƒè¾£å—ï¼Ÿ", kr: "ë§¤ì›Œìš”?", pro: "Mae-wo-yo?" }, { zh: "çµå¸³", kr: "ê³„ì‚°í•´ ì£¼ì„¸ìš”", pro: "Gye-san" }] },
            { cat: "ğŸ›ï¸ è³¼ç‰©", list: [{ zh: "å¤šå°‘éŒ¢ï¼Ÿ", kr: "ì–¼ë§ˆì˜ˆìš”?", pro: "Eol-ma" }, { zh: "å¯ä»¥é€€ç¨…å—ï¼Ÿ", kr: "í…ìŠ¤ ë¦¬í€ ë¼ìš”?", pro: "Tax Refund?" }, { zh: "æœ‰æ–°çš„å—ï¼Ÿ", kr: "ìƒˆ ìƒí’ˆ ìˆì–´ìš”?", pro: "Sae-sang-pum" }] },
            { cat: "ğŸš• äº¤é€š", list: [{ zh: "è«‹è¼‰æˆ‘å»é€™è£¡", kr: "ì—¬ê¸°ë¡œ ê°€ì£¼ì„¸ìš”", pro: "Yeo-gi-ro" }, { zh: "è«‹åœ¨é€™è£¡åœ", kr: "ì—¬ê¸°ì„œ ë‚´ë ¤ì£¼ì„¸ìš”", pro: "Yeo-gi-seo" }] },
            { cat: "ğŸš½ ç·Šæ€¥", list: [{ zh: "å»æ‰€åœ¨å“ªï¼Ÿ", kr: "í™”ì¥ì‹¤ ì–´ë””ì˜ˆìš”?", pro: "Hwa-jang-sil" }, { zh: "å»æ‰€å¯†ç¢¼ï¼Ÿ", kr: "ë¹„ë°€ë²ˆí˜¸ ë­ì˜ˆìš”?", pro: "Bi-mil-beon-ho" }, { zh: "å¹«å¹«æˆ‘", kr: "ë„ì™€ì£¼ì„¸ìš”", pro: "Do-wa-ju-se-yo" }] }
        ];
        
        var curDay = 0, viewMode = 'trip';

        // --- 3. æ ¸å¿ƒåŠŸèƒ½ ---
        function render() {
            var tabs = document.getElementById("tabs"), list = document.getElementById("list");
            var budget = document.getElementById("budget-view"), lang = document.getElementById("lang-view"), sos = document.getElementById("sos-view");
            tabs.innerHTML = "";

            tripData.forEach((d, i) => {
                var btn = document.createElement("button"); 
                // ä¿®æ­£ï¼šæ­£ç¢ºæŠ“å– Day 1, Day 2
                btn.innerText = d.day.split('(')[0].trim(); 
                btn.className = "tab-btn" + (viewMode === 'trip' && curDay === i ? " active" : "");
                btn.onclick = () => { viewMode='trip'; curDay=i; render(); window.scrollTo(0,0); };
                tabs.appendChild(btn);
            });
            
            [
                {id: 'budget', name: 'ğŸ’° é ç®—', class: 'budget-tab'},
                {id: 'lang', name: 'ğŸ—£ï¸ ç¿»è­¯', class: 'lang-tab'},
                {id: 'sos', name: 'ğŸ†˜ æ€¥æ•‘', class: 'sos-tab'}
            ].forEach(t => {
                var btn = document.createElement("button"); btn.innerText = t.name;
                btn.className = "tab-btn " + t.class + (viewMode === t.id ? " active" : "");
                btn.onclick = () => { viewMode = t.id; render(); window.scrollTo(0,0); };
                tabs.appendChild(btn);
            });

            list.style.display = (viewMode === 'trip') ? 'block' : 'none';
            budget.style.display = (viewMode === 'budget') ? 'block' : 'none';
            lang.style.display = (viewMode === 'lang') ? 'block' : 'none';
            sos.style.display = (viewMode === 'sos') ? 'block' : 'none';

            if(viewMode === 'trip') renderDayView();
            if(viewMode === 'budget') renderBudgetView();
            if(viewMode === 'lang') renderLangView();
            if(viewMode === 'sos') renderSosView();
        }

        function renderDayView() {
            var div = document.getElementById("list"); div.innerHTML = "";
            var day = tripData[curDay];
            
            var h = document.createElement("div"); 
            h.innerHTML = `ğŸ“… <b>${day.date} ${day.day}</b>`; 
            h.style.cssText = "margin-bottom:10px; color:#666; font-size:14px; padding-left:5px;";
            div.appendChild(h);

            day.events.forEach((e, idx) => {
                if(e.connect) {
                    div.innerHTML += `<div class="connector"><span>${e.connect}</span></div>`;
                    return;
                }
                
                var noteKey = `note_${curDay}_${idx}`;
                var myNote = localStorage.getItem(noteKey) || "";
                var timeWarn = e.open ? checkTimeStatus(e.open) : "";
                var descHtml = (e.desc || e.price) ? 
                    `<div id="dtl_${idx}" class="detail-area" style="display:none">
                        ${e.desc ? `<div style="margin-bottom:5px">${e.desc}</div>` : ""}
                        ${e.price ? `<div>ğŸ« ${e.price}</div>` : ""}
                     </div>` : "";

                var card = document.createElement("div");
                card.className = "card" + (e.backup ? " backup" : "");
                card.innerHTML = `
                    <div class="card-header">
                        <span class="time-tag">${e.time}</span>
                        <span class="card-icon">${e.icon}</span>
                        <span class="card-title">${e.title}</span>
                        <button class="note-btn ${myNote?'has-note':''}" onclick="toggleNote(${idx})">ğŸ“</button>
                    </div>
                    ${e.open ? `<div class="hours-style">ğŸ•’ ${e.open} ${timeWarn}</div>` : ""}
                    ${e.trans ? `<div class="info-block trans-style">${e.trans}</div>` : ""}
                    ${e.menu ? `<div class="info-block menu-style">ğŸ½ï¸ ${e.menu}</div>` : ""}
                    ${e.note ? `<div class="note-style">ğŸ’¡ ${e.note}</div>` : ""}
                    ${descHtml}
                    <div id="note_area_${idx}" class="note-area" style="display:none">
                        <textarea id="txt_${idx}" class="note-textarea" placeholder="è¼¸å…¥ç­†è¨˜...">${myNote}</textarea>
                        <button class="save-btn" onclick="saveNote(${idx})">å„²å­˜</button>
                        <div style="clear:both"></div>
                    </div>
                    <div id="note_show_${idx}" class="saved-note" style="display:${myNote?'block':'none'}">ğŸ“Œ ${myNote}</div>
                    
                    <div class="btn-row">
                        ${e.kr ? `<button class="action-btn driver-btn" onclick="showKR('${e.kr}')"><span class="btn-icon-lg">ğŸ”</span> çµ¦å¸æ©Ÿ</button>` : ""}
                        
                        ${e.map ? `<a href="https://m.map.naver.com/search2/search.naver?query=${encodeURIComponent(e.map)}" target="_blank" class="action-btn map-btn"><span class="btn-icon-lg">ğŸ—ºï¸</span> Naver åœ°åœ–</a>` : ""}
                        
                        ${e.video ? `<a href="https://www.youtube.com/watch?v=${e.video}" target="_blank" class="action-btn video-btn"><span class="btn-icon-lg">â–¶ï¸</span> å½±ç‰‡</a>` : ""}
                        
                        ${(e.desc||e.price) ? `<button class="action-btn info-btn" onclick="toggleDetail(${idx})"><span class="btn-icon-lg">â„¹ï¸</span> è©³æƒ…</button>` : ""}
                    </div>
                `;
                div.appendChild(card);
            });
        }

        function renderLangView() {
            var html = "";
            phrases.forEach(p => {
                html += `<div class="section-title">${p.cat}</div><div class="phrase-grid">`;
                p.list.forEach(item => {
                    html += `<div class="phrase-card" onclick="speak('${item.kr}')">
                        <div class="ph-zh">${item.zh}</div>
                        <div class="ph-kr">${item.kr}</div>
                        <div class="ph-pro">${item.pro}</div>
                        <div style="text-align:right; margin-top:5px; color:#aaa; font-size:12px;">ğŸ”Š é»æ“Šç™¼éŸ³</div>
                    </div>`;
                });
                html += "</div>";
            });
            document.getElementById("lang-view").innerHTML = html;
        }

        function renderBudgetView() {
            var categories = [
                {id: 'food', name: 'é¤é£²', icon: 'ğŸ”'},
                {id: 'transport', name: 'äº¤é€š', icon: 'ğŸš•'},
                {id: 'shopping', name: 'è³¼ç‰©', icon: 'ğŸ›ï¸'},
                {id: 'ticket', name: 'é–€ç¥¨', icon: 'ğŸ«'},
                {id: 'other', name: 'å…¶ä»–', icon: 'ğŸ“'}
            ];
            
            var ex = JSON.parse(localStorage.getItem('seoul_expenses')) || [];
            var total = ex.reduce((a,b)=>a+b.amt, 0);
            
            var optionsHtml = categories.map(c => `<option value="${c.id}">${c.icon} ${c.name}</option>`).join('');
            
            var listHtml = ex.map((x, i) => {
                var cat = categories.find(c=>c.id === (x.cat || 'other')) || categories[4];
                return `<div class="expense-item">
                    <div style="display:flex; align-items:center;">
                        <span class="ex-cat-icon">${cat.icon}</span>
                        <div><b>${x.desc}</b><br><small>${x.date}</small></div>
                    </div>
                    <div style="text-align:right">
                        <div style="color:#be185d; font-weight:bold;">â‚©${x.amt.toLocaleString()}</div>
                        <div onclick="delEx(${i})" style="color:#999; font-size:12px; margin-top:5px;">åˆªé™¤</div>
                    </div>
                </div>`;
            }).join('');

            document.getElementById("budget-view").innerHTML = `
                <div class="budget-summary">
                    <div class="total-label">ç¸½èŠ±è²»</div>
                    <div class="total-amount">â‚©${total.toLocaleString()}</div>
                </div>
                <div class="budget-form">
                    <div class="form-row">
                        <select id="ex_cat" class="form-select">${optionsHtml}</select>
                    </div>
                    <div class="form-row">
                        <input type="text" id="ex_desc" class="form-input input-desc" placeholder="é …ç›® (å¦‚: çƒ¤è‚‰)">
                        <input type="number" id="ex_amt" class="form-input input-amt" placeholder="é‡‘é¡">
                    </div>
                    <button class="add-expense-btn" onclick="addEx()">ï¼‹ æ–°å¢è¨˜å¸³</button>
                </div>
                <div class="expense-list">${listHtml}</div>
            `;
        }

        function renderSosView() {
            document.getElementById("sos-view").innerHTML = `
                <div style="padding:20px;">
                    <a href="tel:112" class="sos-btn sos-112">ğŸ‘® å ±è­¦ 112</a>
                    <a href="tel:119" class="sos-btn sos-119">ğŸš‘ æ•‘è­· 119</a>
                    <a href="tel:+82-2-3480-5000" class="sos-btn sos-tw">ğŸ‡¹ğŸ‡¼ é§éŸ“ä»£è¡¨è™•</a>
                </div>
            `;
        }

        // --- Helpers ---
        function checkTimeStatus(openTime) {
            if(!openTime || openTime.indexOf('-') === -1) return "";
            var now = new Date();
            var parts = openTime.split('-');
            var end = parts[1].trim();
            var endH = parseInt(end.split(':')[0]), endM = parseInt(end.split(':')[1] || 0);
            var closeTime = new Date(); closeTime.setHours(endH, endM, 0);
            if (endH < 6 && now.getHours() > 12) closeTime.setDate(closeTime.getDate() + 1);
            var diff = (closeTime - now) / 1000 / 60; // diff in minutes
            if (diff < 0 && diff > -600) return '<span class="time-warning warn-closed">ğŸ”´ å·²æ‰“çƒŠ</span>';
            if (diff > 0 && diff < 60) return '<span class="time-warning warn-soon">ğŸŸ  å¿«é—œäº†</span>';
            return "";
        }

        function toggleDetail(id) { var d=document.getElementById('dtl_'+id); d.style.display = (d.style.display==='none'?'block':'none'); }
        function toggleNote(id) { var d=document.getElementById('note_area_'+id); d.style.display = (d.style.display==='none'?'block':'none'); }
        function saveNote(id) {
            var v = document.getElementById('txt_'+id).value;
            localStorage.setItem(`note_${curDay}_${id}`, v);
            renderDayView();
        }
        function showKR(txt) { 
            document.getElementById('m-kr').innerText = txt; 
            document.getElementById('modal').style.display='flex'; 
        }
        function closeVidModal() {
            document.getElementById('vid-modal').style.display = 'none';
            document.getElementById('vid-frame').src = "";
        }
        function speak(txt) {
            window.speechSynthesis.cancel();
            var u = new SpeechSynthesisUtterance(txt);
            u.lang = 'ko-KR';
            window.speechSynthesis.speak(u);
        }
        function findRestroom() {
            window.open("https://m.map.naver.com/search2/search.naver?query=%ED%99%94%EC%9E%A5%EC%8B%A4", "_blank");
        }
        function openLocModal() {
            document.getElementById('loc-modal').style.display = 'flex';
        }
        function closeLocModal() {
            document.getElementById('loc-modal').style.display = 'none';
        }
        function sendMyLoc() {
            if(!navigator.geolocation) return alert("ä¸æ”¯æ´å®šä½");
            navigator.geolocation.getCurrentPosition(function(pos){
                var link = "https://www.google.com/maps?q=" + pos.coords.latitude + "," + pos.coords.longitude;
                if(navigator.share) {
                    navigator.share({title: 'æˆ‘çš„ä½ç½®', text: 'æˆ‘åœ¨é€™è£¡ï¼š', url: link});
                } else {
                    prompt("è¤‡è£½é€£çµï¼š", link);
                }
            }, function(){ alert("ç„¡æ³•å–å¾—ä½ç½®"); });
        }
        function addEx() {
            var c = document.getElementById('ex_cat').value;
            var d = document.getElementById('ex_desc').value;
            var a = parseInt(document.getElementById('ex_amt').value);
            if(!d || !a) return;
            var ex = JSON.parse(localStorage.getItem('seoul_expenses')) || [];
            ex.unshift({date: new Date().toLocaleDateString(), cat: c, desc: d, amt: a});
            localStorage.setItem('seoul_expenses', JSON.stringify(ex));
            renderBudgetView();
        }
        function delEx(i) {
            if(!confirm("åˆªé™¤?")) return;
            var ex = JSON.parse(localStorage.getItem('seoul_expenses')) || [];
            ex.splice(i, 1);
            localStorage.setItem('seoul_expenses', JSON.stringify(ex));
            renderBudgetView();
        }
        function fetchWeather() {
            fetch('https://api.open-meteo.com/v1/forecast?latitude=37.56&longitude=126.97&current_weather=true&daily=temperature_2m_max,temperature_2m_min&timezone=Asia%2FSeoul')
            .then(r=>r.json()).then(d=>{
                document.getElementById('w-temp').innerText = Math.round(d.current_weather.temperature) + "Â°C";
                // ç§»é™¤ç©¿è‘—å»ºè­°é¡¯ç¤º
            });
        }

        // Init
        render();
        fetchWeather();
    </script>
</body>
</html>
